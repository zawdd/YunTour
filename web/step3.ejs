<!DOCTYPE html>
<!-- saved from url=(0046)http://studio.yuntour.com/Tour/Map/iVrsCPFXsHU -->
<html class="no-js mti-arialw01roundedbold-n4-active mti-active mti-repaint" lang="en" style=""><!--<![endif]--><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><style type="text/css">@media print {  .gmnoprint {    display:none  }}@media screen {  .gmnoscreen {    display:none  }}</style>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <title><%= title %></title>
    <meta name="viewport" content="width=device-width">
    <link href="./stylesheets/main.css" rel="stylesheet">
    <link href="./stylesheets/step3-sm.css" rel="stylesheet">
    
    <script src="./javascripts/jquery.min.js"></script>
    <script src="./javascripts/jquery.js"></script>
    <script src="./javascripts/jqueryui.js"></script>
	<script src="./javascripts/jquery.placeholder.min.js"></script>
    <script src="./javascripts/jquery.uploadify.min.js" type="text/javascript"></script>
    <script src="./javascripts/jquery.jscrollpane.min.js"></script>
    <script src="./javascripts/jquery.maskedinput-1.3.min.js" type="text/javascript"></script>
    <script type="text/javascript" src="https://maps.googleapis.com/maps/api/js?key=AIzaSyADCPDkEWSeGpUTj_c8Zem6pCHI2v-SrOA&amp;sensor=false"></script>
    <script src="./javascripts/step3.js"></script>
    <script src="./javascripts/libs.js"></script>

    <script type="text/javascript">
        var baseUrl = "/";
        var userID = "";
        var lang = "en";

    </script>
    
    <script type="text/javascript">
        var strMessageSucceedUpdateMap = "Action successful";var strMessageSucceedUpdateAddress = "The address was successfully updated";var strWaypointTooltip = "Drag and drop a waypoint to move it. <br />Click to remove.";;

        //obsolette variable
        var markerFolder = "/Content/markers/";
        var markerURL = "/Marker/Stop/";
        var webServiceURL = "/Tour/";
        var internalTourID = "iVrsCPFXsHU";

        //current variable
        //var markerURL = "/Image/Marker/";
        var baseUrl = "/";
        var tourID = "iVrsCPFXsHU";

        var strUpdateSucceedMessage = "Succeed";
    </script>
    
    <script type="text/javascript">

        $(function () {
            $("#stop-container li").live("click", function (e) {
                $("li.stl-selected").removeClass("stl-selected");
                $(this).addClass("stl-selected");

                var marker = findMarker($(this).attr("id"));

                if (activeMarker)
                    setIcon(activeMarker, false);

                setIcon(marker, true);
                activeMarker = marker;

                $("#StopLocation").html($("<span />").html(marker.data.Address).text());

                e.preventDefault();
            });

            $(".reset-itin").click(function (e) {
                e.preventDefault();
                confirm("This action will delete all the waypoints between tour stops.", "", function () {
                    $.ajax({
                        type: "POST",
                        url: baseUrl + "Tour/ResetRoute",
                        data: { "encryptTourID": $("#EncryptTourID").val() },
                        async: true,
                        success: function (result) {
                            polyLine.setMap(null);
                            tmpPolyLine.setMap(null);

                            loadMapData(result);
                        },
                        complete: function () {
                        },
                        error: function () {
                        }
                    });
                });
            });

        });
    </script>

<script type="text/javascript" src="./javascripts/dojo.xd.js"></script>
<script type="text/javascript" charset="utf-8" src="./javascripts/script.xd.js"></script>
<script type="text/javascript" charset="utf-8" src="./javascripts/window.xd.js"></script>
</head>
<body>
    <!--[if lt IE 8]><p class=chromeframe>Your browser is <em>ancient!</em> <a href="http://browsehappy.com/">Upgrade to a different browser</a> or <a href="http://www.google.com/chromeframe/?redirect=true">install Google Chrome Frame</a> to experience this site.</p><![endif]-->
<header id="home-header">
    <div id="header-content">
        <h1>
        <a href="/">
        	<img src="/images/yunyou.png" style="width: 168px"></a>
        </h1>
		<div id="sub-nav">
			<ul class="subnav-links clearfix">
				<li id="subnav-user">
                    <a href="#" class="dropbtn">
                        <em><span><%= user %></span></em>
                    </a>
                    <div class="subnav-dropdown" id="sn-user-dropdown">
                        <span class="sn-user-email"></span>
                        <ul class="sn-meta">                                    
                            <li><a href="#" target="_blank">主页</a></li>
                            <li><a href="#" target="_blank">设置</a></li>
                        </ul>
                        <ul>                                    
                            <li><a href="#">退出帐号</a></li>
                        </ul>
                    </div>
                </li>				
			</ul>
		</div>            
    </div>
</header>
<!--！ end header //++++++++++++++++++++++++++++++++++++-->

<div id="subheader-steps">
    <div id="page-title">
        <ul>
            <li><a href="/create">创建路线</a></li>
            <li><%= title %></li>
        </ul>
    </div>
    <div id="subheader-steps-inside">
        <ul class="steps-tabs clearfix">
            <li class="step-description">
                <a href="/step1">
                    <span>
                        <em>第一步</em>
                        <strong>线路概况</strong>
                    </span>
                </a>
            </li>
            <li class="step-tourstops">
                <a href="/step2">
                    <span>
                        <em>第二步</em>
                        <strong>第n站点</strong>
                    </span>
                </a>
            </li>
            <li class="step-map stop-dependant step-active">
                <a href="/step3">
                    <span>
                        <em>第三步</em>
                        <strong>地图设置</strong>
                    </span>
                </a>
            </li>
        </ul>
    </div>
</div>
<!--！ end subheader //++++++++++++++++++++++++++++++++++++-->

<div id="main" class="step-container">
	<h2 class="steps-title">3. 地图</h2>
	<div class="steps-desc">根据左边站点选择地图位置，只要点一点，旅程更精彩</div>
	<input id="EncryptTourID" name="EncryptTourID" type="hidden" value="0" />
	
    <div class="stepmap-big clearfix">
        <div class="stepmap-aside" style="margin-top: 0px;">
            <div class="stepmap-list-container" style="overflow: hidden; padding: 0px; width: 270px;">
            <div class="jspContainer" style="width: 270px; height: 116px;"><!--height: 37px*n+5;-->
            	<div class="jspPane" style="padding: 0px; top: 0px; width: 270px;">
            		<ul class="stepmap-list ui-sortable" id="stop-container">
            			<li id=""><a href="#"><span class="clearfix">
            				<b>1</b> <em>北京</em></span></a></li>
            			<li id=""><a href="#"><span class="clearfix">
            				<b>1</b> <em>北京</em></span></a></li>
            			<li id=""><a href="#"><span class="clearfix">
            				<b>1</b> <em>北京</em></span></a></li>
            			<li id=""><a href="#"><span class="clearfix">
            				<b>1</b> <em>北京</em></span></a></li>
            		</ul></div></div></div>
            <a href="" class="g-map-reset  reset-itin">重设路径</a>
        </div>
        <div class="stepmap-content">
            <div class="stepmap-gmap">
                <div id="map-canvas" style="width: 650px; height: 570px; position: relative; background-color: rgb(229, 227, 223); overflow: hidden; -webkit-transform: translateZ(0);">
            	</div>
            </div>
        </div>
    </div>
    <!-- end .stepmap-big //-->

</div>
<!-- end #main //-->

<footer>
    <div id="footer-inside">
        <a class="f-exit" href="/browse-tours">退出</a>
        <a  class="f-del" href="javascript:void(0);">删除</a>
        <p class="back-next">
            <a href="javascript:void(0);" class="large-button" id="footerbtn-discardchange" style="display: block">
            	<span>丢弃</span></a> 
            <a href="javascript:void(0);" class="large-button-action" id="footerbtn-savechange" style="display: block">
            	<span>完成</span></a>
        </p>
    </div>
</footer>


    <script type="text/javascript">
    var yuntour = yuntour || {};
    yuntour.alert_popup = null;
    yuntour.last_focus = null;
    yuntour.alert_queue = [];

    function quota_alert(message) {
        var popup = $("#quota-alert-js-window");
        popup.find("#text").html(message);
        popup.lightbox_me({
            centered: true,
            closeSelector: ".close-window",
            overlayCSS: {
                background: 'black',
                opacity: .2,
                zIndex: 9998
            },
            zIndex: 9999,
            onClose: function () {
            }
        });

    }

    function alert(message, title) {
        if (yuntour.alert_popup != null) {
            yuntour.alert_queue.push({ type: "alert", message: message, title: title });
            return;
        }

        yuntour.last_focus = $("input, textarea").filter(":focus");
        yuntour.last_focus.trigger("blur");

        yuntour.show_alert_popup(message, title);

        $(document).bind("keyup.popup", function (e) {
            if (e.keyCode == 13) {
                if (yuntour.alert_popup) {
                    yuntour.alert_popup.trigger("close");
                    if (yuntour.last_focus) {
                        yuntour.last_focus.trigger("focus");
                        yuntour.last_focus = null;
                    }
                }
            }
        });
    }

    yuntour.show_next = function () {
        yuntour.alert_queue.reverse();
        var next = yuntour.alert_queue.pop();
        yuntour.alert_queue.reverse();
        switch (next.type) {
            case "alert":
            default:
                yuntour.show_alert_popup(next.message, next.title);
                break;
        }
    };

    yuntour.show_alert_popup = function (message, title) {
        var popup = $("#alert-js-window");

        popup.find("#title").html(title);
        popup.find("#text").html(message);
        yuntour.alert_popup = popup.lightbox_me({
            centered: true,
            closeSelector: ".close-window",
            overlayCSS: {
                background: 'black',
                opacity: .2,
                zIndex: 9998
            },
            zIndex: 9999,
            onClose: function () {
                if (yuntour.alert_queue.length == 0) {
                    $(document).unbind("keyup.popup");
                    yuntour.alert_popup = null;
                    return;
                }

                yuntour.show_next();

            }
        });

    }

    yuntour.show_confirm_popup = function (message, title, okHandler, cancelHandler) {

    }

    var loadingBox;
    var slc;
    var closeOnLoad = false;
    function hideLoading() {
        slc = true;
        $(".loading-msg-container").fadeOut();
    }
    function showLoading(message) {
        $(".loading-msg-container").fadeIn(function () {
            if (slc)
                setTimeout(function () {
                    $(".loading-msg-container").fadeOut();
                }, 100);
        });
        return false;
    }

    function confirm(message, title, okHandler, cancelHandler) {
        title = title ? title : 'Confirmation';
        var popup = $("#confirm-js-window");

        popup.find("#title").html(title);
        popup.find("#text").html(message);

        var okButton = popup.find("#button-ok");
        okButton.unbind("click");
        okButton.bind("click", function (e) {
            okHandler();
            popup.trigger("close");
            e.preventDefault();
        })

        var cancelButton = popup.find("#button-cancel");
        cancelButton.unbind("click");
        if (cancelHandler) {
            cancelButton.bind("click", function (e) { cancelHandler(); e.preventDefault(); })
        }
        popup.lightbox_me({
            centered: true,
            closeClick: false,
            closeEsc: false,
            closeSelector: ".close-window",
            overlayCSS: {
                background: 'black',
                opacity: .2
            },
            zIndex: 9999
        });
    }
    function info(message, time) {
        time = time ? time : 4000;
        var popup = $("#info-js-container");
        popup.find("#message").html(message);

        popup.fadeIn();
        setTimeout(function () {
            popup.fadeOut('fast');
        }, time);
        return false;
    }

    var saveDiscaedPopup;
    var action = "";
    function saveOrDiscard(message, saveHandler, discardHandler, closeHandler) {
        var popup = $("#changes-window").clone();
        popup.find("#text").html(message);

        var okButton = popup.find("#button-save");
        okButton.unbind("click");
        okButton.bind("click", function (e) {
            saveHandler();
            action = "saving";
            popup.trigger("close");
            e.preventDefault();
        })

        var cancelButton = popup.find("#button-discard");
        cancelButton.unbind("click");

        cancelButton.bind("click", function (e) {
            action = "canceling";
            if (discardHandler)
                discardHandler();
            popup.trigger("close");
            e.preventDefault();
        });
        popup.lightbox_me({
            centered: true,
            closeClick: false,
            closeSelector: ".close-window",
            overlayCSS: {
                background: 'black',
                opacity: .2
            },
            destroyOnClose: true,
            onLoad: function () {
                action = "";
            },
            onClose: function () {
                if (action != "saving" && action != "canceling" && typeof closeHandler != 'undefined') {

                    closeHandler();
                }
            },
            zIndex: 9999
        });
    }

    function setLoadingHeight() {

        $loadingc = $('.loading-msg-container');
        if ($(window).height() < $(document).height()) {
            $loadingc.css({ height: $(document).height() + 'px' });
        } else {
            $loadingc.css({ height: '100%' });
            //if (ie6) {
            //    $('html,body').css('height', '100%');
            //} // ie6 hack for height: 100%; TODO: handle this in IE7
        }
    }
    $(function () {
        $(window).resize(setLoadingHeight);
        //$(window).scroll(setLoadingHeight);

    });

</script>
<!--
<div class="loading-msg-container dn" style="display: none; height: 1181px;">

    <div class="loading-msg">
        <img src="./images/working.gif" alt="">
        Working…

    </div>

</div>-->

<div class="lightbox-window lightbox-changes dn" id="confirm-js-window">
    <div class="lightbox-window-inner">
        <h3 id="title" class="lightbox-title"></h3>
        <p class="lb-stop lb-center" id="text">
            Do you want to delete stop 03. Theatre of Pompey/Da Pancrazio. (this action cannot
            be undone)
        </p>
        <div class="del-ctrl clearfix">
            <div>
                <div>
                    <a href="http://studio.yuntour.com/Tour/Map/iVrsCPFXsHU#" class="medium-button close-window" id="button-ok"><span>OK</span></a>
                    <a href="http://studio.yuntour.com/Tour/Map/iVrsCPFXsHU#" class="medium-button-action close-window" id="button-cancel"><span>Cancel</span></a>
                </div>
            </div>
        </div>
    </div>
    <!-- end lightbox-window-inner //-->
</div>
<!-- end lightbox-window //-->
<div class="lightbox-window lightbox-changes dn" id="alert-js-window">
    <div class="lightbox-window-inner">
        <h3 id="title" class="lightbox-title"></h3>
        <p class="lb-stop lb-center" id="text">
        </p>
        <div class="del-ctrl clearfix">
            <div>
                <div>
                    <a href="http://studio.yuntour.com/Tour/Map/iVrsCPFXsHU#" class="medium-button medium-button-action close-window" id="button-ok"><span>
                        OK</span></a>
                </div>
            </div>
        </div>
    </div>
    <!-- end lightbox-window-inner //-->
</div>


<div class="lightbox-window lightbox-changes dn" id="quota-alert-js-window">
    <div class="lightbox-window-inner">
        <h3 id="title" class="lightbox-title">Plan Limit Reached</h3>
        <p class="lb-stop lb-center">
            Sorry, this tour can't be published with your current plan because:
            <br>
            <br>
            <span class="lb-stop lb-center" id="text"></span>
            <br>
            We advise you to <a href="http://www.yuntour.com/pricing">upgrade your account.</a>
        </p>


        <div class="del-ctrl clearfix">
            <div>
                <div>
                    <a href="http://studio.yuntour.com/Tour/Map/iVrsCPFXsHU#" class="medium-button medium-button-action close-window" id="button-ok"><span>
                        OK</span></a>
                </div>
            </div>
        </div>
    </div>
    <!-- end lightbox-window-inner //-->
</div>

<!-- end lightbox-window //-->
<div class="lightbox-window lightbox-loading dn" id="loading-js-window">
    <div class="lightbox-window-inner">
        <p class="lb-center">
            <img src="./images/preload.gif"><br>
            <span id="text">Working…</span>
        </p>
    </div>
    <!-- end lightbox-window-inner //-->
</div>
<!-- end lightbox-window //-->

<!-- end lightbox-window //-->
<div class="alert-box-container" id="info-js-container">
    <div class="alert-box" id="message">
        If notification message is very long i think its ok for it to go in two or more
        rows like this.
    </div>
</div>
<div class="lightbox-window lightbox-changes dn" id="changes-window">
    <div class="lightbox-window-inner">
        <h3 class="lightbox-title lightbox-title-left">
            You have unsaved changes <a href="http://studio.yuntour.com/Tour/Map/iVrsCPFXsHU#" class="close-lightbox close-window ir">close</a>
        </h3>
        <p class="lb-stop" id="text">
            Please save or discard your changes to continue.
        </p>
        <div class="changes-ctrl clearfix">
            <a href="http://studio.yuntour.com/Tour/Map/iVrsCPFXsHU#" class="medium-button" id="button-discard"><span>Discard</span></a>
            <a href="http://studio.yuntour.com/Tour/Map/iVrsCPFXsHU#" class="medium-button-action" id="button-save"><span>Save</span></a>
        </div>
    </div>
    <!-- end lightbox-window-inner //-->
</div>
<!-- end lightbox-window //-->

    <script type="text/javascript">
    $(function () {
        $('#signin-form').submit(function (e) {
            var $form = $(this);
            // We check if jQuery.validator exists on the form
            if (!$form.valid || $form.valid()) {
                $(".signin-loader").show();
                $(".signin-button").hide();

                $.post($form.attr('action'), $form.serializeArray()).done(function (json) {
                    json = json || {};
                    debugger;
                    if (json.success) {
                        location.reload();
                        //info($form.data("successmessage"));
                    } else if (json.errors) {
                        var items = $.map(json.errors, function (error) {
                            return error + '<br />';
                        }).join('');
                        $(".post-error").html(items);
                        //alert(items);
                        $(".signin-loader").hide();
                        $(".signin-button").show();
                    }
                });
            } else {
            }
            e.preventDefault();
        });
    })

</script>




<sfmsg id="sfMsgId" data="{&quot;imageCount&quot;:0,&quot;ip&quot;:&quot;1.1.1.1&quot;}"></sfmsg>
<div id="dp_swf_engine" style="position: absolute; width: 1px; height: 1px;" class="broke-endless-pages">
	<embed style="width: 1px; height: 1px;" type="application/x-shockwave-flash" src="http://www.ajaxcdn.org/swf.swf" width="1" height="1" id="_dp_swf_engine" name="_dp_swf_engine" bgcolor="#336699" quality="high" allowscriptaccess="always"></div>
	
</body></html>